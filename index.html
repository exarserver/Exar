<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.gstatic.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' https://*.firebaseio.com https://*.firebasedatabase.app wss://*.firebasedatabase.app https://formspree.io;">
  
  <title>SERVER EXAR - سيرفر إكسار</title>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  
  <!-- Firebase -->
  <script type="module">
    // Import Firebase functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove, serverTimestamp, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    
    // تحذير مهم: يجب تغيير هذه المفاتيح وإضافة قواعد الأمان في Firebase Console
    // راجع التعليقات في نهاية الملف لمعرفة قواعد الأمان المطلوبة
    const firebaseConfig = {
      apiKey: "AIzaSyB-il2jFPjrro4yYB-mGOZDNXGofOzzk1Q",
      authDomain: "severexar.firebaseapp.com",
      databaseURL: "https://severexar-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "severexar",
      storageBucket: "severexar.firebasestorage.app",
      messagingSenderId: "273479278732",
      appId: "1:273479278732:web:ae28b8a7a3510219559ba9",
      measurementId: "G-RB7DBC8SV8"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth(app);
    
    // Export functions globally
    window.firebaseDB = {
      database,
      ref,
      push,
      set,
      get,
      onValue,
      remove,
      serverTimestamp,
      auth,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    };
  </script>
  
  <!-- تنسيقات CSS -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #667eea;
      --primary-dark: #5a67d8;
      --secondary: #764ba2;
      --accent: #f093fb;
      --success: #48bb78;
      --danger: #f56565;
      --warning: #ed8936;
      --info: #4299e1;
      --dark: #2d3748;
      --light: #f7fafc;
      --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-accent: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: #0f0f1e;
      color: #e2e8f0;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    /* خلفية متحركة */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, #0f0f1e, #1a1a2e, #16213e);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      z-index: -2;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* نقاط متحركة في الخلفية */
    .bg-animation {
      position: fixed;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: -1;
    }
    
    .bg-animation span {
      position: absolute;
      width: 20px;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      animation: move 25s linear infinite;
      border-radius: 50%;
    }
    
    @keyframes move {
      from {
        transform: translateY(100vh) scale(0);
      }
      to {
        transform: translateY(-100vh) scale(1);
      }
    }
    
    /* Header */
    header {
      background: rgba(15, 15, 30, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      border-bottom: 2px solid rgba(102, 126, 234, 0.3);
    }
    
    header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
      animation: pulse 4s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    header h1 {
      font-size: 3.5rem;
      font-weight: 900;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 1;
      text-shadow: 0 0 80px rgba(102, 126, 234, 0.5);
      animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
      from { text-shadow: 0 0 30px rgba(102, 126, 234, 0.5); }
      to { text-shadow: 0 0 50px rgba(102, 126, 234, 0.8), 0 0 70px rgba(118, 75, 162, 0.5); }
    }
    
    /* Navigation */
    nav {
      background: rgba(26, 26, 46, 0.95);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: center;
      gap: 2rem;
      padding: 1.5rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
    }
    
    nav a {
      color: #e2e8f0;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      padding: 0.7rem 1.5rem;
      border-radius: 30px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }
    
    nav a::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: var(--gradient);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.5s ease;
    }
    
    nav a:hover::before {
      width: 300px;
      height: 300px;
    }
    
    nav a:hover {
      color: white;
      transform: translateY(-2px);
      z-index: 1;
    }
    
    nav a span {
      position: relative;
      z-index: 1;
    }
    
    /* Badge */
    .badge {
      background: var(--gradient-accent);
      color: white;
      padding: 3px 8px;
      border-radius: 15px;
      font-size: 0.75rem;
      font-weight: 700;
      position: absolute;
      top: -8px;
      right: -10px;
      box-shadow: 0 2px 10px rgba(240, 147, 251, 0.5);
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    /* Sections */
    section {
      display: none;
      padding: 3rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
      animation: fadeInUp 0.5s ease;
    }
    
    section.active {
      display: block;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Content Cards */
    .content-card {
      background: rgba(26, 26, 46, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(102, 126, 234, 0.2);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    
    .content-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
      border-color: rgba(102, 126, 234, 0.5);
    }
    
    h2 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* Forms */
    form {
      background: rgba(26, 26, 46, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(102, 126, 234, 0.2);
    }
    
    label {
      display: block;
      margin-bottom: 0.5rem;
      color: #a0aec0;
      font-weight: 600;
      font-size: 0.95rem;
    }
    
    input, textarea {
      width: 100%;
      padding: 0.8rem 1.2rem;
      margin-bottom: 1.5rem;
      background: rgba(15, 15, 30, 0.8);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 10px;
      color: #e2e8f0;
      font-size: 1rem;
      transition: all 0.3s ease;
      font-family: 'Cairo', sans-serif;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }
    
    button {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 0.8rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.6s ease;
    }
    
    button:hover::before {
      width: 300px;
      height: 300px;
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
    }
    
    button:active {
      transform: translateY(-1px);
    }
    
    button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }
    
    /* Alerts */
    .alert {
      padding: 1rem 1.5rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      font-weight: 500;
      display: none;
      animation: slideInRight 0.3s ease;
    }
    
    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .error-message {
      background: rgba(245, 101, 101, 0.1);
      border: 1px solid rgba(245, 101, 101, 0.3);
      color: #fc8181;
    }
    
    .success-message {
      background: rgba(72, 187, 120, 0.1);
      border: 1px solid rgba(72, 187, 120, 0.3);
      color: #68d391;
    }
    
    /* Info Boxes */
    .info-box {
      background: rgba(66, 153, 225, 0.1);
      border: 1px solid rgba(66, 153, 225, 0.3);
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      position: relative;
      overflow: hidden;
    }
    
    .info-box::before {
      content: '💡';
      position: absolute;
      top: -20px;
      right: -20px;
      font-size: 4rem;
      opacity: 0.1;
    }
    
    /* Loader */
    .loader {
      width: 50px;
      height: 50px;
      margin: 20px auto;
      display: none;
    }
    
    .loader::after {
      content: '';
      display: block;
      width: 40px;
      height: 40px;
      margin: 5px;
      border-radius: 50%;
      border: 3px solid transparent;
      border-top-color: var(--primary);
      border-bottom-color: var(--secondary);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Rules Section */
    #rules ul {
      list-style: none;
      padding: 0;
    }
    
    #rules li {
      background: rgba(26, 26, 46, 0.8);
      margin-bottom: 1rem;
      padding: 1.2rem;
      border-radius: 10px;
      border-left: 4px solid var(--primary);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    #rules li::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 100%;
      background: rgba(102, 126, 234, 0.1);
      transition: all 0.3s ease;
    }
    
    #rules li:hover::before {
      width: 100%;
    }
    
    #rules li:hover {
      transform: translateX(10px);
    }
    
    /* Admin Section */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: var(--gradient);
      border-radius: 20px;
      padding: 2rem;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(45deg);
      transition: all 0.5s ease;
    }
    
    .stat-card:hover::before {
      top: -60%;
      left: -60%;
    }
    
    .stat-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
    }
    
    .stat-number {
      font-size: 3rem;
      font-weight: 900;
      color: white;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    
    .stat-label {
      color: rgba(255, 255, 255, 0.9);
      font-size: 1.1rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }
    
    /* Application Cards */
    .application-card {
      background: rgba(26, 26, 46, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(102, 126, 234, 0.2);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .application-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.2), transparent);
      transition: all 0.5s ease;
    }
    
    .application-card:hover::after {
      left: 100%;
    }
    
    .application-card:hover {
      transform: translateY(-3px);
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    }
    
    .card-header {
      background: rgba(102, 126, 234, 0.2);
      padding: 0.8rem;
      margin: -1.5rem -1.5rem 1rem;
      border-radius: 20px 20px 10px 10px;
      font-weight: 600;
      color: #e2e8f0;
    }
    
    .admin-note {
      background: rgba(66, 153, 225, 0.1);
      border: 1px solid rgba(66, 153, 225, 0.3);
      border-radius: 10px;
      padding: 0.8rem;
      margin-top: 1rem;
      color: #63b3ed;
      font-style: italic;
    }
    
    .action-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    
    .action-buttons button {
      flex: 1;
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
    }
    
    /* Search Input */
    #searchInput {
      width: 100%;
      padding: 1rem 1.5rem;
      font-size: 1.1rem;
      background: rgba(15, 15, 30, 0.8);
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: 50px;
      color: #e2e8f0;
      margin-bottom: 1.5rem;
      transition: all 0.3s ease;
    }
    
    #searchInput:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
    }
    
    /* Filter Badges */
    .filter-badges {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    
    .filter-badge {
      background: rgba(26, 26, 46, 0.8);
      color: #a0aec0;
      padding: 0.6rem 1.5rem;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      border: 2px solid rgba(102, 126, 234, 0.2);
    }
    
    .filter-badge:hover {
      background: rgba(102, 126, 234, 0.2);
      border-color: var(--primary);
      color: white;
      transform: translateY(-2px);
    }
    
    .filter-badge.active {
      background: var(--gradient);
      color: white;
      border-color: transparent;
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
    }
    
    /* Connection Status */
    .connection-status {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(26, 26, 46, 0.95);
      padding: 0.8rem 1.5rem;
      border-radius: 50px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(102, 126, 234, 0.3);
    }
    
    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #48bb78;
      animation: statusPulse 2s ease-in-out infinite;
    }
    
    @keyframes statusPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.8); }
    }
    
    .status-indicator.offline {
      background: #f56565;
      animation: none;
    }
    
    /* Auth Modal */
    .auth-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }
    
    .auth-modal.active {
      display: flex;
    }
    
    .auth-content {
      background: rgba(26, 26, 46, 0.95);
      padding: 2.5rem;
      border-radius: 20px;
      max-width: 400px;
      width: 90%;
      border: 1px solid rgba(102, 126, 234, 0.3);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      animation: modalFadeIn 0.3s ease;
    }
    
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .auth-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .auth-header h3 {
      font-size: 2rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }
    
    .auth-form input {
      width: 100%;
      margin-bottom: 1rem;
    }
    
    .auth-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    
    .auth-buttons button {
      flex: 1;
    }
    
    .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      background: transparent;
      border: none;
      color: #a0aec0;
      font-size: 2rem;
      cursor: pointer;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .close-modal:hover {
      background: rgba(102, 126, 234, 0.2);
      color: white;
    }
    
    /* Admin Panel Info */
    .admin-info {
      background: rgba(102, 126, 234, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.3);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .admin-info button {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
    }
    
    /* Security Logs */
    .security-log {
      background: rgba(237, 137, 54, 0.1);
      border: 1px solid rgba(237, 137, 54, 0.3);
      color: #f6ad55;
      padding: 0.8rem;
      border-radius: 10px;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    
    /* Security Notice */
    .security-notice {
      background: rgba(245, 101, 101, 0.1);
      border: 1px solid rgba(245, 101, 101, 0.3);
      color: #fc8181;
      padding: 2rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      font-weight: 600;
      text-align: center;
    }
    
    .security-notice h3 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }
    
    /* Footer */
    footer {
      background: rgba(15, 15, 30, 0.95);
      text-align: center;
      padding: 2rem;
      margin-top: 3rem;
      border-top: 1px solid rgba(102, 126, 234, 0.2);
      color: #a0aec0;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      header h1 {
        font-size: 2.5rem;
      }
      
      nav {
        gap: 0.5rem;
        padding: 1rem;
        flex-wrap: wrap;
      }
      
      nav a {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .connection-status {
        bottom: 10px;
        right: 10px;
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }
      
      .auth-content {
        padding: 2rem;
      }
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(15, 15, 30, 0.5);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--gradient);
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
    
    /* Rate Limit Warning */
    .rate-limit-warning {
      background: rgba(237, 137, 54, 0.1);
      border: 1px solid rgba(237, 137, 54, 0.3);
      color: #f6ad55;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      text-align: center;
      display: none;
    }
  </style>
</head>
<body>
  <!-- Force HTTPS -->
  <script>
    if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
      location.replace('https:' + window.location.href.substring(window.location.protocol.length));
    }
  </script>

  <!-- خلفية متحركة -->
  <div class="bg-animation">
    <span style="top: 20%; left: 10%; animation-delay: 0s;"></span>
    <span style="top: 40%; left: 30%; animation-delay: 2s;"></span>
    <span style="top: 60%; left: 50%; animation-delay: 4s;"></span>
    <span style="top: 80%; left: 70%; animation-delay: 6s;"></span>
    <span style="top: 10%; left: 90%; animation-delay: 8s;"></span>
  </div>

  <header>
    <h1>SERVER EXAR</h1>
    <p style="color: #a0aec0; font-size: 1.2rem;">مرحباً بك في عالم الإبداع والمغامرة</p>
  </header>

  <nav>
    <a onclick="showSection('home')"><span>الرئيسية</span></a>
    <a onclick="showSection('apply')"><span>التقديم</span></a>
    <a onclick="showSection('rules')"><span>القوانين</span></a>
    <a onclick="showAdminPanel()" style="position: relative;">
      <span>لوحة الإدارة</span>
      <span id="notificationBadge" class="badge" style="display: none;">0</span>
    </a>
  </nav>

  <main>
    <!-- الرئيسية -->
    <section id="home" class="active">
      <div class="content-card">
        <h2>عن السيرفر</h2>
        <p style="font-size: 1.2rem; line-height: 1.8;">
          مرحباً بك في سيرفر إكسار. 
          انضم إلينا لتعيش تجربة لعب فريدة مع مجتمع رائع من اللاعبين.
          يمكنك التقديم للانضمام إلينا عبر صفحة التقديم.
        </p>
      </div>
    </section>

    <!-- التقديم -->
    <section id="apply">
      <h2>نموذج التقديم</h2>
      
      <div class="info-box">
        <strong>📝 املأ البيانات التالية للتقديم:</strong>
      </div>
      
      <div class="rate-limit-warning" id="rateLimitWarning">
        ⚠️ تم الوصول إلى الحد الأقصى للطلبات. حاول مرة أخرى بعد قليل.
      </div>
      
      <div class="error-message alert" id="errorMessage"></div>
      <div class="success-message alert" id="successMessage"></div>
      
      <form id="applyForm">
        <label>الاسم داخل اللعبة:</label>
        <input type="text" name="ign" id="ign" required maxlength="30" minlength="3" />
        
        <label>حسابك في ديسكورد:</label>
        <input type="text" name="discord" id="discord" placeholder="مثال: username أو username#1234" required />
        
        <label>البريد الإلكتروني:</label>
        <input type="email" name="email" id="email" placeholder="your@email.com" />
        
        <label>العمر:</label>
        <input type="number" name="age" id="age" min="10" max="100" required />
        
        <label>لماذا تريد الانضمام؟</label>
        <textarea name="reason" id="reason" rows="4" required maxlength="500" minlength="10"></textarea>
        
        <button type="submit" id="submitBtn">إرسال الطلب</button>
        <div class="loader" id="loader"></div>
      </form>
    </section>

    <!-- القوانين -->
    <section id="rules">
      <h2>قوانين السيرفر</h2>
      <ul>
        <li>🚫 لا تستخدم الغش أو البرامج الممنوعة</li>
        <li>💬 الاحترام واجب للجميع</li>
        <li>⛏️ لا تسرق أو تدمر ممتلكات اللاعبين</li>
        <li>🛡️ اتبع تعليمات الإدارة دائماً</li>
        <li>🎮 اللعب النظيف والتعاون مع الفريق</li>
        <li>🚪 عدم دخول ممتلكات الآخرين بدون إذن</li>
        <li>💎 عدم سرقة الموارد من اللاعبين</li>
        <li>🔊 استخدام الصوت باحترام في المحادثات</li>
      </ul>
    </section>

    <!-- لوحة الإدارة -->
    <section id="admin">
      <h2>لوحة الإدارة - المتقدمون</h2>
      
      <div class="security-notice" id="securityNotice" style="display: none;">
        <h3>⛔ غير مصرح بالدخول</h3>
        <p>يجب أن تكون إدارياً للوصول إلى هذه الصفحة.</p>
        <p style="margin-top: 0.5rem;">إذا كنت تعتقد أنه يجب أن يكون لديك صلاحيات، تواصل مع مالك الموقع.</p>
        <button onclick="showSection('home')" style="margin-top: 1rem; background: linear-gradient(135deg, #718096 0%, #4a5568 100%);">العودة للرئيسية</button>
      </div>
      
      <!-- معلومات المسؤول -->
      <div class="admin-info" id="adminInfo" style="display: none;">
        <div>
          <strong>مسجل الدخول كـ:</strong> <span id="adminEmail"></span>
          <span id="adminStatus" style="margin-right: 1rem; color: #68d391;"></span>
        </div>
        <button onclick="logout()">تسجيل الخروج</button>
      </div>
      
      <!-- أزرار الإدارة -->
      <div style="margin-bottom: 2rem; display: flex; gap: 0.5rem; flex-wrap: wrap;" id="adminControls">
        <button onclick="exportApplications()" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">📥 تصدير البيانات</button>
        <button onclick="exportToCSV()" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);">📊 تصدير Excel</button>
        <button onclick="syncWithFirebase()" style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);">🔄 مزامنة البيانات</button>
        <button onclick="clearAllApplications()" style="background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);">🗑️ مسح الكل</button>
      </div>
      
      <!-- الإحصائيات -->
      <div class="stats-container" id="statsContainer"></div>
      
      <!-- سجلات الأمان -->
      <div id="securityLogs" style="margin-bottom: 2rem;"></div>
      
      <!-- البحث والفلترة -->
      <input type="text" id="searchInput" placeholder="🔍 البحث في الطلبات..." onkeyup="searchApplications()">
      
      <div class="filter-badges">
        <div class="filter-badge active" onclick="filterByAge('all')">الكل</div>
        <div class="filter-badge" onclick="filterByAge('10-15')">10-15 سنة</div>
        <div class="filter-badge" onclick="filterByAge('16-20')">16-20 سنة</div>
        <div class="filter-badge" onclick="filterByAge('21+')">21+ سنة</div>
      </div>
      
      <div class="info-box">
        <strong>☁️ البيانات محفوظة في السحابة</strong><br>
        <small>✅ البيانات محفوظة في Firebase ويمكن الوصول إليها من أي جهاز.</small>
      </div>
      
      <div id="applications"></div>
    </section>
  </main>

  <!-- نافذة تسجيل الدخول -->
  <div class="auth-modal" id="authModal">
    <div class="auth-content">
      <button class="close-modal" onclick="closeAuthModal()">×</button>
      <div class="auth-header">
        <h3>تسجيل دخول الإدارة</h3>
        <p style="color: #a0aec0;">للمسؤولين المصرح لهم فقط</p>
      </div>
      
      <div class="error-message alert" id="authError"></div>
      
      <form class="auth-form" id="authForm">
        <input type="email" id="authEmail" placeholder="البريد الإلكتروني" required />
        <input type="password" id="authPassword" placeholder="كلمة المرور" required />
        
        <div class="auth-buttons">
          <button type="submit" id="loginBtn">تسجيل الدخول</button>
        </div>
        <p style="text-align: center; margin-top: 1rem; color: #a0aec0; font-size: 0.9rem;">
          للحصول على صلاحيات إدارية، تواصل مع مالك الموقع
        </p>
      </form>
    </div>
  </div>

  <!-- مؤشر حالة الاتصال -->
  <div class="connection-status">
    <span class="status-indicator" id="statusIndicator"></span>
    <span id="statusText">متصل</span>
  </div>

  <footer>
    &copy; 2025 سيرفر إكسار - جميع الحقوق محفوظة | صُمم بـ ❤️
  </footer>

<script>
// انتظار تحميل Firebase
window.addEventListener('DOMContentLoaded', function() {
  // التأكد من تحميل Firebase
  const checkFirebase = setInterval(() => {
    if (window.firebaseDB) {
      clearInterval(checkFirebase);
      initializeApp();
    }
  }, 100);
});

// رابط Formspree - يجب نقله إلى Cloud Function في الإنتاج
const FORMSPREE_ENDPOINT = "https://formspree.io/f/mrbkjnbn";

// متغيرات عامة
let applicationsData = [];
let currentFilter = 'all';
let isOnline = navigator.onLine;
let database, dbRef, dbPush, dbSet, dbGet, dbOnValue, dbRemove, serverTimestamp;
let auth, signInWithEmailAndPassword, signOut, onAuthStateChanged;
let currentUser = null;
let isAdmin = false;

// Rate limiting محسّن
const RateLimiter = {
  attempts: new Map(),
  
  checkLimit(identifier, maxAttempts = 5, windowMs = 3600000) {
    const now = Date.now();
    const key = this.hashIdentifier(identifier);
    const userAttempts = this.attempts.get(key) || [];
    
    // إزالة المحاولات القديمة
    const recentAttempts = userAttempts.filter(time => now - time < windowMs);
    
    if (recentAttempts.length >= maxAttempts) {
      return false; // تجاوز الحد المسموح
    }
    
    recentAttempts.push(now);
    this.attempts.set(key, recentAttempts);
    return true;
  },
  
  getRemainingTime(identifier, windowMs = 3600000) {
    const key = this.hashIdentifier(identifier);
    const userAttempts = this.attempts.get(key) || [];
    if (userAttempts.length === 0) return 0;
    
    const oldestAttempt = Math.min(...userAttempts);
    const timeLeft = (oldestAttempt + windowMs) - Date.now();
    return Math.max(0, Math.ceil(timeLeft / 60000)); // بالدقائق
  },
  
  hashIdentifier(identifier) {
    // تجزئة بسيطة للمعرف
    let hash = 0;
    for (let i = 0; i < identifier.length; i++) {
      const char = identifier.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash;
    }
    return hash.toString();
  }
};

// دالة لتنظيف النصوص من HTML
function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return String(text).replace(/[&<>"']/g, m => map[m]);
}

// دالة التحقق من البيانات
function validateInput(data) {
  const errors = [];
  
  // التحقق من الاسم
  if (!/^[a-zA-Z0-9_\u0600-\u06FF\s]{3,30}$/.test(data.ign)) {
    errors.push('اسم اللاعب يحتوي على أحرف غير مسموحة');
  }
  
  // التحقق من Discord
  const discordRegex = /^([a-zA-Z0-9._]{2,32})(#[0-9]{4})?$/;
  if (!discordRegex.test(data.discord)) {
    errors.push('حساب Discord غير صالح');
  }
  
  // التحقق من البريد الإلكتروني
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (data.email && data.email !== 'غير محدد' && !emailRegex.test(data.email)) {
    errors.push('البريد الإلكتروني غير صالح');
  }
  
  // التحقق من العمر
  if (isNaN(data.age) || data.age < 10 || data.age > 100) {
    errors.push('العمر يجب أن يكون بين 10 و 100');
  }
  
  // التحقق من السبب
  if (data.reason.length < 10 || data.reason.length > 500) {
    errors.push('السبب يجب أن يكون بين 10 و 500 حرف');
  }
  
  // التحقق من الحقن الضار
  const dangerousPatterns = [
    /<script[\s\S]*?<\/script>/gi,
    /<iframe[\s\S]*?<\/iframe>/gi,
    /javascript:/gi,
    /on\w+\s*=/gi
  ];
  
  for (const field of Object.values(data)) {
    for (const pattern of dangerousPatterns) {
      if (pattern.test(String(field))) {
        errors.push('تم اكتشاف محتوى ضار');
        logSecurityEvent('XSS_ATTEMPT', { field, value: field });
        break;
      }
    }
  }
  
  return errors;
}

// دالة لتسجيل الأحداث الأمنية
function logSecurityEvent(eventType, details) {
  if (!database) return;
  
  const logsRef = dbRef(database, 'security_logs');
  const newLogRef = dbPush(logsRef);
  dbSet(newLogRef, {
    type: eventType,
    details: details,
    timestamp: serverTimestamp(),
    userAgent: navigator.userAgent,
    ip: 'hidden' // في الإنتاج، احصل على IP من الخادم
  }).catch(console.error);
}

// تهيئة التطبيق
function initializeApp() {
  // الحصول على مراجع Firebase
  const fb = window.firebaseDB;
  database = fb.database;
  dbRef = fb.ref;
  dbPush = fb.push;
  dbSet = fb.set;
  dbGet = fb.get;
  dbOnValue = fb.onValue;
  dbRemove = fb.remove;
  serverTimestamp = fb.serverTimestamp;
  auth = fb.auth;
  signInWithEmailAndPassword = fb.signInWithEmailAndPassword;
  signOut = fb.signOut;
  onAuthStateChanged = fb.onAuthStateChanged;
  
  // مراقبة حالة المصادقة
  onAuthStateChanged(auth, async (user) => {
    currentUser = user;
    if (user) {
      // التحقق من صلاحيات المسؤول
      await checkAdminStatus(user);
      if (!isAdmin) {
        // تسجيل خروج المستخدمين غير المصرح لهم
        await signOut(auth);
        currentUser = null;
      } else if (document.getElementById('admin').classList.contains('active')) {
        showAdminInfo(user);
        loadApplications();
        await updateStats();
        loadSecurityLogs();
      }
    }
  });
  
  // بدء الاستماع للتغييرات
  listenToFirebaseChanges();
  updateConnectionStatus();
  updateNotificationBadge();
  syncWithFirebase();
}

// التحقق من صلاحيات المسؤول
async function checkAdminStatus(user) {
  try {
    const adminRef = dbRef(database, `admins/${user.uid}`);
    const snapshot = await dbGet(adminRef);
    isAdmin = snapshot.exists() && snapshot.val() === true;
    
    if (isAdmin) {
      document.getElementById('adminStatus').textContent = '✓ مسؤول معتمد';
      document.getElementById('adminStatus').style.color = '#68d391';
    } else {
      document.getElementById('adminStatus').textContent = '⚠️ غير مصرح';
      document.getElementById('adminStatus').style.color = '#f6ad55';
    }
  } catch (error) {
    console.error('خطأ في التحقق من الصلاحيات:', error);
    isAdmin = false;
  }
}

// مراقبة حالة الاتصال
window.addEventListener('online', () => {
  isOnline = true;
  updateConnectionStatus();
  syncWithFirebase();
});

window.addEventListener('offline', () => {
  isOnline = false;
  updateConnectionStatus();
});

// تحديث حالة الاتصال
function updateConnectionStatus() {
  const indicator = document.getElementById('statusIndicator');
  const text = document.getElementById('statusText');
  
  if (isOnline) {
    indicator.classList.remove('offline');
    text.textContent = 'متصل';
  } else {
    indicator.classList.add('offline');
    text.textContent = 'غير متصل';
  }
}

// مراقبة التغييرات في Firebase
function listenToFirebaseChanges() {
  const applicationsRef = dbRef(database, 'applications');
  
  dbOnValue(applicationsRef, async (snapshot) => {
    const data = snapshot.val();
    if (data) {
      applicationsData = Object.keys(data).map(key => ({
        ...data[key],
        id: key
      }));
      updateNotificationBadge();
      if (currentUser && isAdmin && document.getElementById('admin').classList.contains('active')) {
        loadApplications();
        await updateStats();
      }
    }
  });
}

// حفظ الطلب في Firebase
async function saveApplicationToFirebase(application) {
  try {
    const applicationsRef = dbRef(database, 'applications');
    const newAppRef = dbPush(applicationsRef);
    await dbSet(newAppRef, {
      ...application,
      timestamp: serverTimestamp()
    });
    return newAppRef.key;
  } catch (error) {
    console.error('خطأ في حفظ البيانات في Firebase:', error);
    throw error;
  }
}

// تحديث شارة التنبيهات
function updateNotificationBadge() {
  const badge = document.getElementById('notificationBadge');
  const lastVisit = localStorage.getItem('lastAdminVisit');
  let newCount = 0;
  
  if (lastVisit) {
    const lastVisitDate = new Date(lastVisit);
    newCount = applicationsData.filter(app => new Date(app.date) > lastVisitDate).length;
  } else {
    newCount = applicationsData.length;
  }
  
  if (newCount > 0) {
    badge.textContent = newCount;
    badge.style.display = 'block';
  } else {
    badge.style.display = 'none';
  }
}

// تحميل سجلات الأمان
async function loadSecurityLogs() {
  if (!isAdmin) return;
  
  try {
    const logsRef = dbRef(database, 'security_logs');
    const snapshot = await dbGet(logsRef);
    const logsContainer = document.getElementById('securityLogs');
    
    if (snapshot.exists()) {
      const logs = snapshot.val();
      const recentLogs = Object.entries(logs)
        .map(([key, log]) => ({ id: key, ...log }))
        .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0))
        .slice(0, 5);
      
      if (recentLogs.length > 0) {
        logsContainer.innerHTML = '<h3 style="margin-bottom: 1rem;">سجلات الأمان الأخيرة:</h3>';
        recentLogs.forEach(log => {
          const logDate = log.timestamp ? new Date(log.timestamp).toLocaleString('ar-SA') : 'غير محدد';
          logsContainer.innerHTML += `
            <div class="security-log">
              <strong>${escapeHtml(log.type)}</strong> - ${logDate}
              ${log.details ? `<br><small>${escapeHtml(JSON.stringify(log.details))}</small>` : ''}
            </div>
          `;
        });
      } else {
        logsContainer.innerHTML = '';
      }
    }
  } catch (error) {
    console.error('خطأ في تحميل سجلات الأمان:', error);
  }
}

// دوال عامة
window.showSection = function(id) {
  document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

window.showError = function(message, elementId = 'errorMessage') {
  const errorDiv = document.getElementById(elementId);
  if (errorDiv) {
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    setTimeout(() => {
      errorDiv.style.display = 'none';
    }, 5000);
  }
}

window.showSuccess = function(message) {
  const successDiv = document.getElementById('successMessage');
  if (successDiv) {
    successDiv.textContent = message;
    successDiv.style.display = 'block';
    setTimeout(() => {
      successDiv.style.display = 'none';
    }, 5000);
  }
}

// عرض لوحة الإدارة
window.showAdminPanel = async function() {
  if (!currentUser) {
    document.getElementById('authModal').classList.add('active');
  } else {
    showSection('admin');
    if (isAdmin) {
      document.getElementById('securityNotice').style.display = 'none';
      document.getElementById('adminControls').style.display = 'flex';
      document.getElementById('statsContainer').style.display = 'grid';
      document.getElementById('searchInput').style.display = 'block';
      document.querySelector('.filter-badges').style.display = 'flex';
      document.getElementById('applications').style.display = 'block';
      loadApplications();
      await updateStats();
      loadSecurityLogs();
      showAdminInfo(currentUser);
      localStorage.setItem('lastAdminVisit', new Date().toISOString());
      document.getElementById('notificationBadge').style.display = 'none';
    } else {
      // إخفاء جميع عناصر لوحة الإدارة
      document.getElementById('securityNotice').style.display = 'block';
      document.getElementById('adminControls').style.display = 'none';
      document.getElementById('statsContainer').style.display = 'none';
      document.getElementById('searchInput').style.display = 'none';
      document.querySelector('.filter-badges').style.display = 'none';
      document.getElementById('applications').style.display = 'none';
      document.getElementById('securityLogs').innerHTML = '';
      document.getElementById('adminInfo').style.display = 'none';
    }
  }
}

// عرض معلومات المسؤول
function showAdminInfo(user) {
  document.getElementById('adminInfo').style.display = 'flex';
  document.getElementById('adminEmail').textContent = user.email;
}

// إغلاق نافذة المصادقة
window.closeAuthModal = function() {
  document.getElementById('authModal').classList.remove('active');
  document.getElementById('authError').style.display = 'none';
}

// معالج تسجيل الدخول
document.getElementById('authForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const email = document.getElementById('authEmail').value.trim();
  const password = document.getElementById('authPassword').value;
  
  document.getElementById('loginBtn').disabled = true;
  
  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    
    // التحقق الفوري من الصلاحيات
    await checkAdminStatus(user);
    
    if (isAdmin) {
      closeAuthModal();
      showSection('admin');
      showSuccess('تم تسجيل الدخول بنجاح!');
    } else {
      // تسجيل خروج المستخدم غير المصرح له
      await signOut(auth);
      showError('⛔ ليس لديك صلاحيات إدارية. يجب أن تكون إدارياً للوصول.', 'authError');
      logSecurityEvent('UNAUTHORIZED_ACCESS_ATTEMPT', { email });
    }
  } catch (error) {
    console.error('خطأ في تسجيل الدخول:', error);
    logSecurityEvent('FAILED_LOGIN', { email });
    if (error.code === 'auth/user-not-found') {
      showError('لا يوجد حساب بهذا البريد الإلكتروني', 'authError');
    } else if (error.code === 'auth/wrong-password') {
      showError('كلمة المرور غير صحيحة', 'authError');
    } else if (error.code === 'auth/invalid-email') {
      showError('البريد الإلكتروني غير صالح', 'authError');
    } else if (error.code === 'auth/invalid-credential') {
      showError('البيانات المدخلة غير صحيحة', 'authError');
    } else {
      showError('خطأ في تسجيل الدخول. تحقق من البيانات وحاول مرة أخرى.', 'authError');
    }
  } finally {
    document.getElementById('loginBtn').disabled = false;
  }
});

// تسجيل الخروج
window.logout = async function() {
  if (confirm('هل تريد تسجيل الخروج؟')) {
    try {
      await signOut(auth);
      showSection('home');
      showSuccess('تم تسجيل الخروج بنجاح');
    } catch (error) {
      showError('خطأ في تسجيل الخروج');
    }
  }
}

// معالج إرسال النموذج
document.getElementById('applyForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  // التحقق من تحميل Firebase
  if (!database) {
